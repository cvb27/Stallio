{% extends "master/layout.html" %}

{% block content %}
<div class="container-fluid">
  <div class="d-sm-flex align-items-center justify-content-between mb-4">
    
  </div>

  <div class="card shadow mb-4">
    <div class="card-body">    
        <h5 class="mb-0">Usuarios</h5>
      <div class="table-responsive">
        <table class="table table-sm table-striped">
            
          <thead>
            
            <tr>
              <th>ID</th>
              <th>Email</th>
              <th>Name</th>
              <th>Public page</th>
              <th>Rol</th>
              <th>Activo</th>
              <th>Created</th>
              
              <th style="width: 160px;">Acción</th>
            </tr>
          </thead>
          <tbody>
            {% for u in users %}
              {% set row = rows[loop.index0] %}
            <tr>
              <td>#{{ u.id }}</td>
              <td class="text-monospace">{{ u.email }}</td>
              <td>{{ u.name or '-' }}</td>
              <td>
            {% if row.public_url %}
              <a href="{{ row.public_url }}" target="_blank">
            {{ row.public_url }}
              </a>
            {% else %}
              <span class="text-muted small">No page</span>
            {% endif %}
            </td>
              <td>{{ u.role }}</td>
              <td>
                {% if u.is_active %}
                  <span class="badge badge-success">Activo</span>
                {% else %}
                  <span class="badge badge-secondary">Inactivo</span>
                {% endif %}
              </td>
              <td>{{ u.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
              <td>
                {% if u.is_active %}
                <form method="post" action="/admin/users/{{ u.id }}/deactivate" style="display:inline;">
                  <button class="btn btn-sm btn-outline-danger" onclick="return confirm('¿Desactivar este usuario?');">
                    Desactivar
                  </button>
                  <a class="btn btn-outline-danger btn-sm" href="/admin/users/{{ u.id }}/delete">
                    Eliminar
                  </a>
                </form>
                {% else %}
                <form method="post" action="/admin/users/{{ u.id }}/activate" style="display:inline;">
                  <button class="btn btn-sm btn-outline-success" onclick="return confirm('¿Activar este usuario?');">
                    Activar
                  </button>
                </form>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <small class="text-muted">Usa activar/desactivar para altas y bajas sin eliminar datos.</small>
    </div>
  </div>
</div>
{% endblock %}